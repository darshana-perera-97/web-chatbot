<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <title>Chatbot Debug Page</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #f5f5f5;
        }
        .debug-section {
            background: white;
            padding: 20px;
            margin: 10px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .error { color: red; }
        .success { color: green; }
        .info { color: blue; }
        #console-output {
            background: #f8f8f8;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <h1>Chatbot Debug Page</h1>
    
    <div class="debug-section">
        <h2>üîç Environment Check</h2>
        <p><strong>Current Protocol:</strong> <span id="protocol"></span></p>
        <p><strong>Current Domain:</strong> <span id="domain"></span></p>
        <p><strong>User Agent:</strong> <span id="user-agent"></span></p>
    </div>

    <div class="debug-section">
        <h2>üåê Backend Connectivity Test</h2>
        <button onclick="testBackend()">Test Backend Connection</button>
        <div id="backend-result"></div>
    </div>

    <div class="debug-section">
        <h2>üì± Frontend Load Test</h2>
        <button onclick="testFrontend()">Test Frontend Load</button>
        <div id="frontend-result"></div>
    </div>

    <div class="debug-section">
        <h2>üìã Console Output</h2>
        <div id="console-output"></div>
        <button onclick="clearConsole()">Clear Console</button>
    </div>

    <div class="debug-section">
        <h2>ü§ñ Chatbot Widget Test</h2>
        <button onclick="loadChatbot()">Load Chatbot Widget</button>
        <div id="chatbot-container"></div>
    </div>

    <script>
        // Capture console output
        const originalLog = console.log;
        const originalError = console.error;
        const consoleOutput = document.getElementById('console-output');
        
        function addToConsole(message, type = 'log') {
            const timestamp = new Date().toLocaleTimeString();
            const className = type === 'error' ? 'error' : type === 'success' ? 'success' : 'info';
            consoleOutput.innerHTML += `<div class="${className}">[${timestamp}] ${message}</div>`;
            consoleOutput.scrollTop = consoleOutput.scrollHeight;
        }

        console.log = function(...args) {
            originalLog.apply(console, args);
            addToConsole(args.join(' '), 'log');
        };

        console.error = function(...args) {
            originalError.apply(console, args);
            addToConsole(args.join(' '), 'error');
        };

        // Environment info
        document.getElementById('protocol').textContent = window.location.protocol;
        document.getElementById('domain').textContent = window.location.hostname;
        document.getElementById('user-agent').textContent = navigator.userAgent;

        // Test backend connectivity
        async function testBackend() {
            const resultDiv = document.getElementById('backend-result');
            resultDiv.innerHTML = '<p class="info">Testing backend connection...</p>';
            
            try {
                const response = await fetch('http://69.197.187.24:8080/', {
                    method: 'GET',
                    mode: 'cors'
                });
                
                if (response.ok) {
                    const text = await response.text();
                    resultDiv.innerHTML = `<p class="success">‚úÖ Backend connected! Response: ${text}</p>`;
                    console.log('Backend test successful:', text);
                } else {
                    resultDiv.innerHTML = `<p class="error">‚ùå Backend responded with status: ${response.status}</p>`;
                    console.error('Backend test failed with status:', response.status);
                }
            } catch (error) {
                resultDiv.innerHTML = `<p class="error">‚ùå Backend connection failed: ${error.message}</p>`;
                console.error('Backend test error:', error);
            }
        }

        // Test frontend load
        async function testFrontend() {
            const resultDiv = document.getElementById('frontend-result');
            resultDiv.innerHTML = '<p class="info">Testing frontend load...</p>';
            
            try {
                const response = await fetch('http://69.197.187.24:3003/', {
                    method: 'GET',
                    mode: 'cors'
                });
                
                if (response.ok) {
                    resultDiv.innerHTML = `<p class="success">‚úÖ Frontend loaded! Status: ${response.status}</p>`;
                    console.log('Frontend test successful');
                } else {
                    resultDiv.innerHTML = `<p class="error">‚ùå Frontend responded with status: ${response.status}</p>`;
                    console.error('Frontend test failed with status:', response.status);
                }
            } catch (error) {
                resultDiv.innerHTML = `<p class="error">‚ùå Frontend load failed: ${error.message}</p>`;
                console.error('Frontend test error:', error);
            }
        }

        // Load chatbot widget
        function loadChatbot() {
            const container = document.getElementById('chatbot-container');
            container.innerHTML = '<p class="info">Loading chatbot widget...</p>';
            
            try {
                // Create iframe
                const iframe = document.createElement('iframe');
                iframe.src = 'http://69.197.187.24:3003/';
                iframe.style.width = '380px';
                iframe.style.height = '560px';
                iframe.style.border = '0';
                iframe.style.borderRadius = '12px';
                iframe.style.boxShadow = '0 10px 30px rgba(0,0,0,0.15)';
                iframe.allow = 'clipboard-read; clipboard-write';
                
                iframe.onload = function() {
                    container.innerHTML = '<p class="success">‚úÖ Chatbot widget loaded!</p>';
                    container.appendChild(iframe);
                    console.log('Chatbot widget loaded successfully');
                };
                
                iframe.onerror = function(error) {
                    container.innerHTML = `<p class="error">‚ùå Chatbot widget failed to load: ${error}</p>`;
                    console.error('Chatbot widget load error:', error);
                };
                
                container.appendChild(iframe);
            } catch (error) {
                container.innerHTML = `<p class="error">‚ùå Error creating chatbot widget: ${error.message}</p>`;
                console.error('Chatbot widget creation error:', error);
            }
        }

        function clearConsole() {
            document.getElementById('console-output').innerHTML = '';
        }

        // Auto-run tests on page load
        window.addEventListener('load', function() {
            console.log('Debug page loaded');
            console.log('Protocol:', window.location.protocol);
            console.log('Domain:', window.location.hostname);
            
            // Check for mixed content
            if (window.location.protocol === 'https:' && 
                (window.location.href.includes('http://') || 
                 document.querySelector('script[src^="http://"]') || 
                 document.querySelector('iframe[src^="http://"]'))) {
                console.error('‚ö†Ô∏è MIXED CONTENT DETECTED: HTTPS page trying to load HTTP resources');
            }
        });
    </script>
</body>
</html>

